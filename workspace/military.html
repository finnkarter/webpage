<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전역 계산기</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .military-container { max-width: 800px; margin: 0 auto; }
        .d-day { font-size: 4em; font-weight: bold; text-align: center; margin: 20px 0; 
                 background: linear-gradient(135deg, var(--primary), var(--secondary));
                 -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .progress-bar { background: var(--bg-hover); height: 30px; border-radius: 15px; 
                       overflow: hidden; margin: 20px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); 
                        transition: width 0.5s; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
                    gap: 15px; margin: 30px 0; }
        .info-card { background: var(--bg-dark); padding: 20px; border-radius: 10px; text-align: center; }
        .info-value { font-size: 2em; color: var(--primary); font-weight: bold; }
        .setup-form { background: var(--bg-dark); padding: 30px; border-radius: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: var(--text-secondary); }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <a href="index.html" class="back-btn">← 뒤로</a>
            <h1>전역 계산기</h1>
        </div>
        
        <div class="content military-container">
            <div id="setupForm" class="setup-form" style="display: none;">
                <h2>복무 정보 입력</h2>
                <form onsubmit="saveMilitaryInfo(event)">
                    <div class="form-group">
                        <label>입대일</label>
                        <input type="date" id="enlistDate" required>
                    </div>
                    <div class="form-group">
                        <label>복무 구분</label>
                        <select id="serviceType" required>
                            <option value="18">육군/해병대 (18개월)</option>
                            <option value="20">해군 (20개월)</option>
                            <option value="21">공군 (21개월)</option>
                        </select>
                    </div>
                    <button type="submit" style="width: 100%;">설정 완료</button>
                </form>
            </div>
            
            <div id="militaryInfo" style="display: none;">
                <div class="d-day" id="dDay">D-000</div>
                <p style="text-align: center; color: var(--text-secondary);" id="dischargeDate">전역일: -</p>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
                <p style="text-align: center;" id="progressText">0% 완료</p>
                
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-value" id="servedDays">0</div>
                        <div>복무일</div>
                    </div>
                    <div class="info-card">
                        <div class="info-value" id="remainingDays">0</div>
                        <div>남은날</div>
                    </div>
                    <div class="info-card">
                        <div class="info-value" id="weekends">0</div>
                        <div>남은주말</div>
                    </div>
                    <div class="info-card">
                        <div class="info-value" id="percent">0%</div>
                        <div>진행률</div>
                    </div>
                </div>
                
                <button onclick="resetInfo()" style="background: var(--danger); width: 100%; margin-top: 20px;">재설정</button>
            </div>
        </div>
    </div>
    
    <script>
        const data = JSON.parse(localStorage.getItem('militaryData'));
        
        function saveMilitaryInfo(e) {
            e.preventDefault();
            const enlistDate = document.getElementById('enlistDate').value;
            const months = parseInt(document.getElementById('serviceType').value);
            const discharge = new Date(enlistDate);
            discharge.setMonth(discharge.getMonth() + months);
            discharge.setDate(discharge.getDate() - 1);
            
            localStorage.setItem('militaryData', JSON.stringify({
                enlistDate, serviceMonths: months, dischargeDate: discharge.toISOString().split('T')[0]
            }));
            location.reload();
        }
        
        function updateDisplay() {
            if (!data) {
                document.getElementById('setupForm').style.display = 'block';
                return;
            }
            
            document.getElementById('militaryInfo').style.display = 'block';
            const now = new Date();
            const enlist = new Date(data.enlistDate);
            const discharge = new Date(data.dischargeDate);
            
            const totalDays = Math.ceil((discharge - enlist) / (1000 * 60 * 60 * 24));
            const served = Math.ceil((now - enlist) / (1000 * 60 * 60 * 24));
            const remaining = Math.ceil((discharge - now) / (1000 * 60 * 60 * 24));
            const progress = Math.min(100, Math.max(0, (served / totalDays) * 100));
            
            let weekends = 0;
            for (let d = new Date(now); d <= discharge; d.setDate(d.getDate() + 1)) {
                if (d.getDay() === 0 || d.getDay() === 6) weekends++;
            }
            
            document.getElementById('dDay').textContent = remaining > 0 ? `D-${remaining}` : '전역!';
            document.getElementById('dischargeDate').textContent = `전역일: ${discharge.toLocaleDateString('ko-KR')}`;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = progress.toFixed(1) + '% 완료';
            document.getElementById('servedDays').textContent = served;
            document.getElementById('remainingDays').textContent = Math.max(0, remaining);
            document.getElementById('weekends').textContent = weekends;
            document.getElementById('percent').textContent = progress.toFixed(1) + '%';
        }
        
        function resetInfo() {
            if (confirm('재설정하시겠습니까?')) {
                localStorage.removeItem('militaryData');
                location.reload();
            }
        }
        
        updateDisplay();
        if (data) setInterval(updateDisplay, 60000);
    </script>
</body>
</html>