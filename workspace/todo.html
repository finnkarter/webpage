<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>할 일 목록</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .todo-input-group { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .todo-input { flex: 1; min-width: 200px; }
        .todo-item { background: var(--bg-dark); padding: 15px; border-radius: 10px; 
                    margin-bottom: 10px; display: flex; align-items: center; gap: 15px; }
        .todo-item.completed { opacity: 0.6; }
        .todo-item.completed .todo-text { text-decoration: line-through; }
        .todo-checkbox { width: 20px; height: 20px; cursor: pointer; }
        .todo-text { flex: 1; }
        .priority { padding: 4px 10px; border-radius: 15px; font-size: 0.85em; color: white; }
        .priority-high { background: var(--danger); }
        .priority-medium { background: var(--warning); }
        .priority-low { background: var(--primary); }
        .filter-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filter-btn { background: var(--bg-dark); border: 2px solid var(--border); 
                     padding: 8px 16px; border-radius: 20px; cursor: pointer; }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); 
                gap: 15px; margin-bottom: 20px; }
        .stat-card { background: var(--bg-dark); padding: 15px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 2em; color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <a href="index.html" class="back-btn">← 뒤로</a>
            <h1>할 일 목록</h1>
        </div>
        
        <div class="content">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalCount">0</div>
                    <div>전체</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pendingCount">0</div>
                    <div>대기중</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="completedCount">0</div>
                    <div>완료</div>
                </div>
            </div>
            
            <div class="todo-input-group">
                <input type="text" id="todoInput" class="todo-input" 
                       placeholder="할 일을 입력하세요..." onkeypress="if(event.key==='Enter')addTodo()">
                <select id="prioritySelect">
                    <option value="low">낮음</option>
                    <option value="medium" selected>보통</option>
                    <option value="high">높음</option>
                </select>
                <input type="date" id="dueDateInput">
                <button onclick="addTodo()">추가</button>
            </div>
            
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="setFilter('all', this)">전체</button>
                <button class="filter-btn" onclick="setFilter('pending', this)">대기중</button>
                <button class="filter-btn" onclick="setFilter('completed', this)">완료</button>
                <button class="filter-btn" onclick="setFilter('today', this)">오늘</button>
            </div>
            
            <div id="todoList"></div>
        </div>
    </div>
    
    <script>
        let todos = JSON.parse(localStorage.getItem('todos')) || [];
        let currentFilter = 'all';
        
        function addTodo() {
            const text = document.getElementById('todoInput').value.trim();
            if (!text) return;
            
            todos.unshift({
                id: Date.now(),
                text,
                completed: false,
                priority: document.getElementById('prioritySelect').value,
                dueDate: document.getElementById('dueDateInput').value,
                createdAt: new Date().toISOString()
            });
            
            saveTodos();
            document.getElementById('todoInput').value = '';
            document.getElementById('dueDateInput').value = '';
            displayTodos();
        }
        
        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                saveTodos();
                displayTodos();
            }
        }
        
        function deleteTodo(id) {
            todos = todos.filter(t => t.id !== id);
            saveTodos();
            displayTodos();
        }
        
        function setFilter(filter, btn) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            displayTodos();
        }
        
        function saveTodos() {
            localStorage.setItem('todos', JSON.stringify(todos));
            updateStats();
        }
        
        function displayTodos() {
            let filtered = todos;
            const today = new Date().toDateString();
            
            if (currentFilter === 'pending') filtered = todos.filter(t => !t.completed);
            else if (currentFilter === 'completed') filtered = todos.filter(t => t.completed);
            else if (currentFilter === 'today') filtered = todos.filter(t => 
                t.dueDate && new Date(t.dueDate).toDateString() === today
            );
            
            const list = document.getElementById('todoList');
            
            if (filtered.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">할 일이 없습니다.</p>';
                return;
            }
            
            // 정렬: 미완료 우선, 우선순위 높은 순
            filtered.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                const priority = { high: 0, medium: 1, low: 2 };
                return priority[a.priority] - priority[b.priority];
            });
            
            list.innerHTML = filtered.map(todo => {
                const priorityText = { high: '높음', medium: '보통', low: '낮음' };
                const dueText = todo.dueDate ? ` (${new Date(todo.dueDate).toLocaleDateString()})` : '';
                
                return `
                    <div class="todo-item ${todo.completed ? 'completed' : ''}">
                        <input type="checkbox" class="todo-checkbox" 
                               ${todo.completed ? 'checked' : ''} 
                               onchange="toggleTodo(${todo.id})">
                        <span class="todo-text">${escapeHtml(todo.text)}${dueText}</span>
                        <span class="priority priority-${todo.priority}">${priorityText[todo.priority]}</span>
                        <button class="delete" onclick="deleteTodo(${todo.id})">삭제</button>
                    </div>
                `;
            }).join('');
        }
        
        function updateStats() {
            document.getElementById('totalCount').textContent = todos.length;
            document.getElementById('pendingCount').textContent = todos.filter(t => !t.completed).length;
            document.getElementById('completedCount').textContent = todos.filter(t => t.completed).length;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        displayTodos();
        updateStats();
    </script>
</body>
</html>