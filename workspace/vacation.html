<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>휴가 계획</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .vacation-settings { background: var(--bg-dark); padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .setting-item { display: flex; align-items: center; gap: 10px; }
        .setting-label { flex: 1; }
        .setting-input { width: 60px; text-align: center; }
        .vacation-form { background: var(--bg-dark); padding: 25px; border-radius: 15px; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        .vacation-list { display: grid; gap: 15px; }
        .vacation-item { background: var(--bg-dark); padding: 20px; border-radius: 10px; 
                        border-left: 4px solid var(--primary); position: relative; }
        .vacation-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .vacation-title { font-size: 1.2em; font-weight: bold; }
        .vacation-type { background: var(--primary); color: white; padding: 4px 12px; 
                        border-radius: 15px; font-size: 0.85em; }
        .vacation-dates { color: var(--text-secondary); margin: 5px 0; }
        .vacation-days { background: var(--bg-hover); padding: 4px 10px; border-radius: 10px; 
                        font-weight: bold; margin-left: 10px; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
                       gap: 15px; margin-bottom: 20px; }
        .summary-card { background: var(--bg-dark); padding: 20px; border-radius: 10px; text-align: center; }
        .summary-value { font-size: 2.5em; color: var(--primary); font-weight: bold; }
        .type-regular { border-left-color: #4a9eff; }
        .type-reward { border-left-color: #4aff4a; }
        .type-consolation { border-left-color: #ff9a4a; }
        .type-special { border-left-color: #ff4aff; }
        .progress-bar { background: var(--bg-hover); height: 20px; border-radius: 10px; 
                       overflow: hidden; margin: 5px 0; }
        .progress-fill { height: 100%; transition: width 0.5s; }
        .regular-fill { background: #4a9eff; }
        .reward-fill { background: #4aff4a; }
        .consolation-fill { background: #ff9a4a; }
        .special-fill { background: #ff4aff; }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <a href="index.html" class="back-btn">← 뒤로</a>
            <h1>군 휴가 계획</h1>
        </div>
        
        <div class="content">
            <!-- 휴가 설정 -->
            <div class="vacation-settings">
                <h3>휴가 일수 설정</h3>
                <div class="settings-grid">
                    <div class="setting-item">
                        <span class="setting-label">🏖️ 정기휴가:</span>
                        <input type="number" id="regularDays" class="setting-input" value="21" min="0" onchange="updateSettings()">
                        <span>일</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">🎖️ 포상휴가:</span>
                        <input type="number" id="rewardDays" class="setting-input" value="10" min="0" onchange="updateSettings()">
                        <span>일</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">💝 위로휴가:</span>
                        <input type="number" id="consolationDays" class="setting-input" value="5" min="0" onchange="updateSettings()">
                        <span>일</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">⭐ 특별휴가:</span>
                        <input type="number" id="specialDays" class="setting-input" value="0" min="0" onchange="updateSettings()">
                        <span>일</span>
                    </div>
                </div>
            </div>
            
            <!-- 휴가 요약 -->
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-value" id="totalDays">36</div>
                    <div>총 휴가일</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="usedDays">0</div>
                    <div>사용한 휴가</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="remainingDays">36</div>
                    <div>남은 휴가</div>
                </div>
            </div>
            
            <!-- 휴가 종류별 현황 -->
            <div style="background: var(--bg-dark); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                <h3>휴가 종류별 사용 현황</h3>
                <div style="margin-top: 15px;">
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>정기휴가</span>
                            <span id="regularStatus">0 / 21일</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill regular-fill" id="regularBar"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>포상휴가</span>
                            <span id="rewardStatus">0 / 10일</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill reward-fill" id="rewardBar"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>위로휴가</span>
                            <span id="consolationStatus">0 / 5일</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill consolation-fill" id="consolationBar"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>특별휴가</span>
                            <span id="specialStatus">0 / 0일</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill special-fill" id="specialBar"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 휴가 추가 폼 -->
            <div class="vacation-form">
                <h3>새 휴가 추가</h3>
                <form onsubmit="addVacation(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>휴가 종류</label>
                            <select id="vacationType" required>
                                <option value="regular">정기휴가</option>
                                <option value="reward">포상휴가</option>
                                <option value="consolation">위로휴가</option>
                                <option value="special">특별휴가</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>휴가명</label>
                            <input type="text" id="vacationName" placeholder="예: 첫 휴가" required>
                        </div>
                        <div class="form-group">
                            <label>시작일</label>
                            <input type="date" id="startDate" required onchange="updateEndDate()">
                        </div>
                        <div class="form-group">
                            <label>종료일</label>
                            <input type="date" id="endDate" required>
                        </div>
                    </div>
                    <button type="submit" style="width: 100%; margin-top: 15px;">휴가 추가</button>
                </form>
            </div>
            
            <h3>휴가 목록</h3>
            <div class="vacation-list" id="vacationList"></div>
        </div>
    </div>
    
    <script>
        let vacations = JSON.parse(localStorage.getItem('vacations')) || [];
        let vacationSettings = JSON.parse(localStorage.getItem('vacationSettings')) || {
            regular: 21,
            reward: 10,
            consolation: 5,
            special: 0
        };
        
        const vacationTypes = {
            regular: { name: '정기휴가', icon: '🏖️', color: '#4a9eff' },
            reward: { name: '포상휴가', icon: '🎖️', color: '#4aff4a' },
            consolation: { name: '위로휴가', icon: '💝', color: '#ff9a4a' },
            special: { name: '특별휴가', icon: '⭐', color: '#ff4aff' }
        };
        
        function loadSettings() {
            document.getElementById('regularDays').value = vacationSettings.regular;
            document.getElementById('rewardDays').value = vacationSettings.reward;
            document.getElementById('consolationDays').value = vacationSettings.consolation;
            document.getElementById('specialDays').value = vacationSettings.special;
        }
        
        function updateSettings() {
            vacationSettings = {
                regular: parseInt(document.getElementById('regularDays').value) || 0,
                reward: parseInt(document.getElementById('rewardDays').value) || 0,
                consolation: parseInt(document.getElementById('consolationDays').value) || 0,
                special: parseInt(document.getElementById('specialDays').value) || 0
            };
            localStorage.setItem('vacationSettings', JSON.stringify(vacationSettings));
            updateSummary();
        }
        
        function addVacation(e) {
            e.preventDefault();
            const type = document.getElementById('vacationType').value;
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            
            if (new Date(start) > new Date(end)) {
                alert('시작일이 종료일보다 늦을 수 없습니다.');
                return;
            }
            
            const days = Math.ceil((new Date(end) - new Date(start)) / (1000 * 60 * 60 * 24)) + 1;
            
            // 남은 휴가 일수 체크
            const used = getUsedDaysByType(type);
            const total = vacationSettings[type];
            if (used + days > total) {
                alert(`${vacationTypes[type].name}의 남은 일수(${total - used}일)를 초과합니다.`);
                return;
            }
            
            vacations.push({
                id: Date.now(),
                type: type,
                name: document.getElementById('vacationName').value,
                startDate: start,
                endDate: end,
                days: days
            });
            
            saveVacations();
            e.target.reset();
            displayVacations();
        }
        
        function getUsedDaysByType(type) {
            const now = new Date();
            return vacations
                .filter(v => v.type === type)
                .reduce((sum, v) => {
                    const endDate = new Date(v.endDate);
                    if (endDate < now) {
                        return sum + v.days;
                    } else if (new Date(v.startDate) <= now && endDate >= now) {
                        const elapsed = Math.ceil((now - new Date(v.startDate)) / (1000 * 60 * 60 * 24));
                        return sum + elapsed;
                    }
                    return sum;
                }, 0);
        }
        
        function deleteVacation(id) {
            if (confirm('삭제하시겠습니까?')) {
                vacations = vacations.filter(v => v.id !== id);
                saveVacations();
                displayVacations();
            }
        }
        
        function saveVacations() {
            localStorage.setItem('vacations', JSON.stringify(vacations));
            updateSummary();
        }
        
        function displayVacations() {
            const list = document.getElementById('vacationList');
            
            if (vacations.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">예정된 휴가가 없습니다.</p>';
                return;
            }
            
            vacations.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
            
            list.innerHTML = vacations.map(v => {
                const typeInfo = vacationTypes[v.type];
                const status = getStatus(v.startDate, v.endDate);
                
                return `
                    <div class="vacation-item type-${v.type}">
                        <div class="vacation-header">
                            <div>
                                <div class="vacation-title">${v.name}</div>
                                <span class="vacation-type" style="background: ${typeInfo.color};">
                                    ${typeInfo.icon} ${typeInfo.name}
                                </span>
                                <span class="vacation-days">${v.days}일</span>
                                ${status}
                            </div>
                            <button class="delete" onclick="deleteVacation(${v.id})">삭제</button>
                        </div>
                        <div class="vacation-dates">
                            📅 ${new Date(v.startDate).toLocaleDateString()} ~ ${new Date(v.endDate).toLocaleDateString()}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getStatus(start, end) {
            const now = new Date();
            const startDate = new Date(start);
            const endDate = new Date(end);
            
            if (endDate < now) return '<span style="color: var(--text-secondary);">(완료)</span>';
            if (startDate <= now && endDate >= now) return '<span style="color: var(--secondary);">(진행중)</span>';
            
            const daysUntil = Math.ceil((startDate - now) / (1000 * 60 * 60 * 24));
            return `<span style="color: var(--warning);">D-${daysUntil}</span>`;
        }
        
        function updateSummary() {
            const total = Object.values(vacationSettings).reduce((sum, days) => sum + days, 0);
            let totalUsed = 0;
            
            // 종류별 사용 현황 계산
            Object.keys(vacationSettings).forEach(type => {
                const used = getUsedDaysByType(type);
                const typeTotal = vacationSettings[type];
                const percent = typeTotal > 0 ? (used / typeTotal) * 100 : 0;
                
                totalUsed += used;
                
                // 상태 텍스트 업데이트
                document.getElementById(`${type}Status`).textContent = `${used} / ${typeTotal}일`;
                
                // 프로그레스 바 업데이트
                const bar = document.getElementById(`${type}Bar`);
                bar.style.width = `${Math.min(100, percent)}%`;
            });
            
            // 전체 요약 업데이트
            document.getElementById('totalDays').textContent = total;
            document.getElementById('usedDays').textContent = totalUsed;
            document.getElementById('remainingDays').textContent = total - totalUsed;
        }
        
        function updateEndDate() {
            const startDate = document.getElementById('startDate').value;
            document.getElementById('endDate').min = startDate;
            if (!document.getElementById('endDate').value) {
                document.getElementById('endDate').value = startDate;
            }
        }
        
        // 오늘 날짜로 기본값 설정
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('startDate').min = today;
        document.getElementById('endDate').min = today;
        
        // 초기화
        loadSettings();
        displayVacations();
        updateSummary();
    </script>
</body>
</html>