<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íœ´ê°€ ê³„íš</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .vacation-settings { background: var(--bg-dark); padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .setting-item { display: flex; align-items: center; gap: 10px; }
        .setting-label { flex: 1; }
        .setting-input { width: 60px; text-align: center; }
        .vacation-form { background: var(--bg-dark); padding: 25px; border-radius: 15px; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        .vacation-list { display: grid; gap: 15px; }
        .vacation-item { background: var(--bg-dark); padding: 20px; border-radius: 10px; 
                        border-left: 4px solid var(--primary); position: relative; }
        .vacation-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .vacation-title { font-size: 1.2em; font-weight: bold; }
        .vacation-type { background: var(--primary); color: white; padding: 4px 12px; 
                        border-radius: 15px; font-size: 0.85em; }
        .vacation-dates { color: var(--text-secondary); margin: 5px 0; }
        .vacation-days { background: var(--bg-hover); padding: 4px 10px; border-radius: 10px; 
                        font-weight: bold; margin-left: 10px; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
                       gap: 15px; margin-bottom: 20px; }
        .summary-card { background: var(--bg-dark); padding: 20px; border-radius: 10px; text-align: center; }
        .summary-value { font-size: 2.5em; color: var(--primary); font-weight: bold; }
        .type-regular { border-left-color: #4a9eff; }
        .type-reward { border-left-color: #4aff4a; }
        .type-consolation { border-left-color: #ff9a4a; }
        .type-special { border-left-color: #ff4aff; }
        .progress-bar { background: var(--bg-hover); height: 20px; border-radius: 10px; 
                       overflow: hidden; margin: 5px 0; }
        .progress-fill { height: 100%; transition: width 0.5s; }
        .regular-fill { background: #4a9eff; }
        .reward-fill { background: #4aff4a; }
        .consolation-fill { background: #ff9a4a; }
        .special-fill { background: #ff4aff; }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <a href="index.html" class="back-btn">â† ë’¤ë¡œ</a>
            <h1>êµ° íœ´ê°€ ê³„íš</h1>
        </div>
        
        <div class="content">
            <!-- íœ´ê°€ ì„¤ì • -->
            <div class="vacation-settings">
                <h3>íœ´ê°€ ì¼ìˆ˜ ì„¤ì •</h3>
                <div class="settings-grid">
                    <div class="setting-item">
                        <span class="setting-label">ğŸ–ï¸ ì •ê¸°íœ´ê°€:</span>
                        <input type="number" id="regularDays" class="setting-input" value="21" min="0" onchange="updateSettings()">
                        <span>ì¼</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">ğŸ–ï¸ í¬ìƒíœ´ê°€:</span>
                        <input type="number" id="rewardDays" class="setting-input" value="10" min="0" onchange="updateSettings()">
                        <span>ì¼</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">ğŸ’ ìœ„ë¡œíœ´ê°€:</span>
                        <input type="number" id="consolationDays" class="setting-input" value="5" min="0" onchange="updateSettings()">
                        <span>ì¼</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">â­ íŠ¹ë³„íœ´ê°€:</span>
                        <input type="number" id="specialDays" class="setting-input" value="0" min="0" onchange="updateSettings()">
                        <span>ì¼</span>
                    </div>
                </div>
            </div>
            
            <!-- íœ´ê°€ ìš”ì•½ -->
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-value" id="totalDays">36</div>
                    <div>ì´ íœ´ê°€ì¼</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="usedDays">0</div>
                    <div>ì‚¬ìš©í•œ íœ´ê°€</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="remainingDays">36</div>
                    <div>ë‚¨ì€ íœ´ê°€</div>
                </div>
            </div>
            
            <!-- íœ´ê°€ ì¢…ë¥˜ë³„ í˜„í™© -->
            <div style="background: var(--bg-dark); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                <h3>íœ´ê°€ ì¢…ë¥˜ë³„ ì‚¬ìš© í˜„í™©</h3>
                <div style="margin-top: 15px;">
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>ì •ê¸°íœ´ê°€</span>
                            <span id="regularStatus">0 / 21ì¼</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill regular-fill" id="regularBar"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>í¬ìƒíœ´ê°€</span>
                            <span id="rewardStatus">0 / 10ì¼</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill reward-fill" id="rewardBar"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>ìœ„ë¡œíœ´ê°€</span>
                            <span id="consolationStatus">0 / 5ì¼</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill consolation-fill" id="consolationBar"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>íŠ¹ë³„íœ´ê°€</span>
                            <span id="specialStatus">0 / 0ì¼</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill special-fill" id="specialBar"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- íœ´ê°€ ì¶”ê°€ í¼ -->
            <div class="vacation-form">
                <h3>ìƒˆ íœ´ê°€ ì¶”ê°€</h3>
                <form onsubmit="addVacation(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>íœ´ê°€ ì¢…ë¥˜</label>
                            <select id="vacationType" required>
                                <option value="regular">ì •ê¸°íœ´ê°€</option>
                                <option value="reward">í¬ìƒíœ´ê°€</option>
                                <option value="consolation">ìœ„ë¡œíœ´ê°€</option>
                                <option value="special">íŠ¹ë³„íœ´ê°€</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>íœ´ê°€ëª…</label>
                            <input type="text" id="vacationName" placeholder="ì˜ˆ: ì²« íœ´ê°€" required>
                        </div>
                        <div class="form-group">
                            <label>ì‹œì‘ì¼</label>
                            <input type="date" id="startDate" required onchange="updateEndDate()">
                        </div>
                        <div class="form-group">
                            <label>ì¢…ë£Œì¼</label>
                            <input type="date" id="endDate" required>
                        </div>
                    </div>
                    <button type="submit" style="width: 100%; margin-top: 15px;">íœ´ê°€ ì¶”ê°€</button>
                </form>
            </div>
            
            <h3>íœ´ê°€ ëª©ë¡</h3>
            <div class="vacation-list" id="vacationList"></div>
        </div>
    </div>
    
    <script>
        let vacations = JSON.parse(localStorage.getItem('vacations')) || [];
        let vacationSettings = JSON.parse(localStorage.getItem('vacationSettings')) || {
            regular: 21,
            reward: 10,
            consolation: 5,
            special: 0
        };
        
        const vacationTypes = {
            regular: { name: 'ì •ê¸°íœ´ê°€', icon: 'ğŸ–ï¸', color: '#4a9eff' },
            reward: { name: 'í¬ìƒíœ´ê°€', icon: 'ğŸ–ï¸', color: '#4aff4a' },
            consolation: { name: 'ìœ„ë¡œíœ´ê°€', icon: 'ğŸ’', color: '#ff9a4a' },
            special: { name: 'íŠ¹ë³„íœ´ê°€', icon: 'â­', color: '#ff4aff' }
        };
        
        function loadSettings() {
            document.getElementById('regularDays').value = vacationSettings.regular;
            document.getElementById('rewardDays').value = vacationSettings.reward;
            document.getElementById('consolationDays').value = vacationSettings.consolation;
            document.getElementById('specialDays').value = vacationSettings.special;
        }
        
        function updateSettings() {
            vacationSettings = {
                regular: parseInt(document.getElementById('regularDays').value) || 0,
                reward: parseInt(document.getElementById('rewardDays').value) || 0,
                consolation: parseInt(document.getElementById('consolationDays').value) || 0,
                special: parseInt(document.getElementById('specialDays').value) || 0
            };
            localStorage.setItem('vacationSettings', JSON.stringify(vacationSettings));
            updateSummary();
        }
        
        function addVacation(e) {
            e.preventDefault();
            const type = document.getElementById('vacationType').value;
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            
            if (new Date(start) > new Date(end)) {
                alert('ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const days = Math.ceil((new Date(end) - new Date(start)) / (1000 * 60 * 60 * 24)) + 1;
            
            // ë‚¨ì€ íœ´ê°€ ì¼ìˆ˜ ì²´í¬
            const used = getUsedDaysByType(type);
            const total = vacationSettings[type];
            if (used + days > total) {
                alert(`${vacationTypes[type].name}ì˜ ë‚¨ì€ ì¼ìˆ˜(${total - used}ì¼)ë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`);
                return;
            }
            
            vacations.push({
                id: Date.now(),
                type: type,
                name: document.getElementById('vacationName').value,
                startDate: start,
                endDate: end,
                days: days
            });
            
            saveVacations();
            e.target.reset();
            displayVacations();
        }
        
        function getUsedDaysByType(type) {
            const now = new Date();
            return vacations
                .filter(v => v.type === type)
                .reduce((sum, v) => {
                    const endDate = new Date(v.endDate);
                    if (endDate < now) {
                        return sum + v.days;
                    } else if (new Date(v.startDate) <= now && endDate >= now) {
                        const elapsed = Math.ceil((now - new Date(v.startDate)) / (1000 * 60 * 60 * 24));
                        return sum + elapsed;
                    }
                    return sum;
                }, 0);
        }
        
        function deleteVacation(id) {
            if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                vacations = vacations.filter(v => v.id !== id);
                saveVacations();
                displayVacations();
            }
        }
        
        function saveVacations() {
            localStorage.setItem('vacations', JSON.stringify(vacations));
            updateSummary();
        }
        
        function displayVacations() {
            const list = document.getElementById('vacationList');
            
            if (vacations.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">ì˜ˆì •ëœ íœ´ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            vacations.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
            
            list.innerHTML = vacations.map(v => {
                const typeInfo = vacationTypes[v.type];
                const status = getStatus(v.startDate, v.endDate);
                
                return `
                    <div class="vacation-item type-${v.type}">
                        <div class="vacation-header">
                            <div>
                                <div class="vacation-title">${v.name}</div>
                                <span class="vacation-type" style="background: ${typeInfo.color};">
                                    ${typeInfo.icon} ${typeInfo.name}
                                </span>
                                <span class="vacation-days">${v.days}ì¼</span>
                                ${status}
                            </div>
                            <button class="delete" onclick="deleteVacation(${v.id})">ì‚­ì œ</button>
                        </div>
                        <div class="vacation-dates">
                            ğŸ“… ${new Date(v.startDate).toLocaleDateString()} ~ ${new Date(v.endDate).toLocaleDateString()}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getStatus(start, end) {
            const now = new Date();
            const startDate = new Date(start);
            const endDate = new Date(end);
            
            if (endDate < now) return '<span style="color: var(--text-secondary);">(ì™„ë£Œ)</span>';
            if (startDate <= now && endDate >= now) return '<span style="color: var(--secondary);">(ì§„í–‰ì¤‘)</span>';
            
            const daysUntil = Math.ceil((startDate - now) / (1000 * 60 * 60 * 24));
            return `<span style="color: var(--warning);">D-${daysUntil}</span>`;
        }
        
        function updateSummary() {
            const total = Object.values(vacationSettings).reduce((sum, days) => sum + days, 0);
            let totalUsed = 0;
            
            // ì¢…ë¥˜ë³„ ì‚¬ìš© í˜„í™© ê³„ì‚°
            Object.keys(vacationSettings).forEach(type => {
                const used = getUsedDaysByType(type);
                const typeTotal = vacationSettings[type];
                const percent = typeTotal > 0 ? (used / typeTotal) * 100 : 0;
                
                totalUsed += used;
                
                // ìƒíƒœ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                document.getElementById(`${type}Status`).textContent = `${used} / ${typeTotal}ì¼`;
                
                // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì—…ë°ì´íŠ¸
                const bar = document.getElementById(`${type}Bar`);
                bar.style.width = `${Math.min(100, percent)}%`;
            });
            
            // ì „ì²´ ìš”ì•½ ì—…ë°ì´íŠ¸
            document.getElementById('totalDays').textContent = total;
            document.getElementById('usedDays').textContent = totalUsed;
            document.getElementById('remainingDays').textContent = total - totalUsed;
        }
        
        function updateEndDate() {
            const startDate = document.getElementById('startDate').value;
            document.getElementById('endDate').min = startDate;
            if (!document.getElementById('endDate').value) {
                document.getElementById('endDate').value = startDate;
            }
        }
        
        // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ê¸°ë³¸ê°’ ì„¤ì •
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('startDate').min = today;
        document.getElementById('endDate').min = today;
        
        // ì´ˆê¸°í™”
        loadSettings();
        displayVacations();
        updateSummary();
    </script>
</body>
</html>